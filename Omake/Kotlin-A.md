# Kotlin 数据结构

在覆盖了语言基础的大部分内容后，我们将目光转向标准库。Kotlin 能够使用 Java 标准库中的所有内容，此外还增添了大量方便的类和方法。标准库非常庞大，涉及文件读写、网络访问、进程控制等多个方面。在这个小节里，我们从数据结构这方面来入手，了解如何使用 Kotlin 所提供的大量可重用代码来构造程序。

## 集合

**集合（Collection）**是数据结构标准库中的重要组成部分。集合能够**收集一系列元素**，并且要能支持元素的添加、删除和查找。话虽如此，但在 Kotlin 中，集合通常是一系列具有集合特征的数据结构的统称，它们可被分为以下几种，各有各的用途。

Kotlin 中的集合，大多数都区分**可变**与**不可变**，这一点与最开始介绍的不可变变量相同 —— 一开始让所有的集合都不可变，然后，将必须改变的集合设置为可变，但绝不要超出这个范围。只有可变的集合才支持修改、删除等改变集合的操作，它们通常有 `Mutable` 前缀。

?> 集合中的内容只能为同一种类型，这一点与 Python 不同。

### 列表

**列表（List）**类似于 C 语言中的数组，它有序地存储元素 —— 元素之间彼此有先后关系。每个元素在列表中都有一个编号，即**索引（Index）**。第一个元素的索引是 `0`，第二个是 `1`，以此类推。

要创建一个列表，最简单的方式是使用 `listOf` 或 `mutableListOf` 方法。前者创建不可变列表，后者创建可变列表。

```kotlin
val a = mutableListOf<Int>(1, 2, 3)
val b = listOf("1", "2", "str")
```

以上的两个例子中，第一个使用了模板参数 `Int`，第二个则省略了，这是因为 `listOf` 和 `mutableListOf` 方法均是泛型方法，能够支持任何类型的元素。和 Kotlin 中其它部分的泛型一样，在信息足够的情况下，Kotlin 可以自动推断类型参数，因此 `<Int>` 是可以省略的。

?> 如果不提供任何参数，Kotlin 将创建一个空列表，但此时必须指定类型。

---

列表支持如下的操作：

- **添加**：在给定的位置添加元素，包括在尾部添加、在头部添加和在指定元素之后插入。
  
  ```kotlin
  a.add(3) // 在末尾添加 3
  a.addFirst(3) // 在开头添加 3
  a.add(1, 3) // 将 3 插入列表，使得其索引为 1（即在索引为 0 的元素后插入 3）
  ```

- **删除**：删除给定的元素，或者给定索引，删除索引所对应的元素。
  
  ```kotlin
  a.removeLast() // 删除末尾的元素
  a.removeFirst() // 删除开头的元素
  a.removeAt(1) // 删除索引为 1 的元素
  a.remove(3) // 删除元素 3，如果有多个，仅删除一个
  ```
  
  ?> `remove` 方法并不保证删除的元素的位置，也许是在开头，也许是在末尾，也许是中间的某个位置，这由具体实现来决定。

- **查找**：根据给定的条件，寻址一个元素的索引。
  
  ```kotlin
  a.indexOf(3) // 查找元素 3 的索引，如果有多个，返回第一个的索引；如果没有，则返回 -1
  a.find { it > 0 } // 查找第一个大于 0 的元素的索引
  ```

- **遍历**：使用一个 Lambda 函数访问列表中的每个元素。
  
  ```kotlin
  a.forEach { println(it) } // 打印列表中的每个元素
  ```

- **映射**：将列表中的每个元素通过一个 Lambda 函数映射到一个新元素，将这些新元素收集起来，成为一个列表。
  
  ```kotlin
  a.map { it * 2 } // 将列表中的每个元素乘 2，组成一个新列表
  ```

- **筛选**：选择列表中满足某些条件的元素，组成一个新列表。
  
  ```kotlin
  a.filter { it > 0 } // 选择所有大于 0 的元素，组成一个新列表
  ```

这些操作可以很容易地组合起来，形成链式调用：

```kotlin
a.map { it * 3 }
 .filter { it % 2 == 0 }
 .find { it > 5 }
 ?.let { println(it) }
```

注意到最后一步调用并非列表的功能之一，而是取 `find` 的返回结果再通过 `let` 进行输出，以和链式调用相契合。

?> 条件关系 `?.` 运算符类似于关系运算符 `.`，但是它仅在被调的对象不是 `null` 时才执行其后的部分，否则整个表达式的值为 `null`。在上面的例子中，如果存在一个大于 5 的元素，则程序会输出它，如果不存在，则程序什么也不做。

---

列表有几种不同的**实现**，它们都提供了上述的这些功能（实现了 `List` 接口的功能），但由于内部结构不同，这些实现在性能上有所差异。一些操作可能在某些实现中比较快，而在其它实现中则很慢。编写程序时，必须考虑不同实现之间的差异。

在 Kotlin 中，常用的列表实现有以下两种（事实上是两类）：

- `ArrayList`：底层使用数组实现。随机访问、替换元素、在尾部插入或删除比较快，但是在中间插入或删除元素则很慢。

- `LinkedList`：底层使用节点和彼此之间的引用实现。顺序访问、插入和删除元素比较快，但是随机访问则很慢。

除此之外还有一些用于特殊用途的实现，例如 `Vector` 等，受限于篇幅，这里就不一一介绍了。

### 无序集

无序集 `Set` 和列表相反，它们也收集元素，但不关心元素彼此之间的顺序，也就是说，没有所谓的“第一个”或者“最后一个”元素，元素只是单纯地“存在”于集合当中。注意，这不代表所有的 `Set` 内部都是无序的 —— 有些实现会保留元素的顺序，但 `Set` 不做任何保证。

要创建一个无序集，使用 `setOf` 和 `mutableSetOf` 方法。同样，这些方法也接受类型参数。

```kotlin
val a = mutableSetOf<Int>(1, 2, 3)
val b = setOf("1", "2", "str")
```
