# Kotlin 流程控制

语句如果只能一条一条从上往下执行，那虽然比字面量有趣，但时间长了还是令人感到乏味。这一节我们将介绍流程控制，程序正是从这里开始变得有趣起来的。

## 哦，选择！

当我们需要根据某些条件做不同的事情时，我们就会使用 `if`。在 Kotlin 中，`if` 的写法和 C 基本相同：

```kotlin
val a = 1
var b = 0
if (a > 0) {
    b = 1
}
```

只有当小括号 `()` 中的**条件**成立时，大括号 `{}` 中的语句方才得到执行。这就是 **`if` 表达式（"If" Expression）**，它根据条件选择执行一些语句，所以也被称为选择分支。

---

当然，有时候我们需要使用 `else` 来表示“否则就……”的含义：

```kotlin
val a = 1
var b = 0
if (a > 0) {
    b = 1
} else {
    b = 2
}
```

这就是 **`if-else` 表达式（"If-Else" Expression）**。当然，我们先前提到过，块 `{}` 只是一个包装，如果块内只有一条语句，那么在这里是可以去掉的，于是这个程序可以写作：

```kotlin
val a = 1
var b = 0
if (a > 0) b = 1 else b = 2
```

这一点和 C 相同。

---

等等，你刚才说了**表达式**对吧？`if` 不是**语句**吗？现在看来或许如此，不过在 Kotlin 中，你可以尝试下面这种看上去很奇怪的写法：

```kotlin
val a = 1
val b = if (a > 0) 1 else 2
```

这是没问题的，`if` 表达式（它确实是一个表达式！）的值**是它所实际选择的那条分支语句的值**。这分为两种情况：

- 如果分支有且只有一条语句（而且不是块），取决于这条语句的类型：
  
  - 如果是表达式求值，那么这个分支的值就是**该表达式的值**。
  
  - 否则，这个分支的值是 `Unit`。

- 如果分支是一个块：
  
  - 如果块内没有语句，则这个分支的值是 `Unit`。
  
  - 如果块内有不止一条语句，则这个分支的值是**最后一条语句的值**。最后一条语句的值按照上面的方法求出。

在上面这个例子中，两条分支上都只有一条语句（分别是 `1` 和 `2`），因此如果 `a` 大于 `0`，则赋值符号 `=` 右侧的表达式值就是 `1`，否则就是 `2`。然后，这个值被赋给 `b`。下面的的例子是一个更全面的说明：

```kotlin
val a = 1
val b = if (a > 0) {
    val c = a * a + 8
    c
} else {
    val d = a + 8
}
```

如果 `a` 大于 `0`，那么 `if` 取第一个块的最后一条语句作为其值，即**表达式** `c`（从而 `b` 最终被赋值为 `9`）。如果 `a` 并不大于 `0`，那么 `if` 取第二个块的最后一条语句 —— 这次是一个**定义**语句，那么值是 `Unit`。所以，`b` 的值是 `Int` 或 `Unit`，Kotlin 会自动为 `b` 选择一个合适的类型，能够存储这种情况。

?> 这里有一个特殊情况：如果块内的语句是一条定义语句，则不能省略大括号 `{}`，这一点可以用命名空间来解释，我们稍后会介绍。

哦对了，`if` 必须和 `else` 搭配才能作为一个表达式使用。如果 `else` 中确实没什么要做的事，那么可以写一个空白的块。

---

Kotlin 为什么要把 `if` 设计成表达式呢？很大程度上还是出于方便起见。很快你就会发现，这种写法极其灵活，非常方便。Kotlin 中到处都是这种方便的特性，这也是它能快速适应到各种应用场景中的原因。

## 青苹果，红苹果

如果程序只能“向前走，不回头”，那还是做不了什么重要的事情。我们可以使用**循环（Loop）**来重复做一些事情：

```kotlin
var a = 100
while (a > 0) {
    a--
}
```

?> `++` 和 `--` 是自增和自减运算符，可以加在数值变量的前方或后方。`++` 将其加 `1`，而 `--` 将其减 `1`。此外，这两个运算符所放置的位置也很重要，放在后方时，代表“先求值再运算”，即该表达式的值是变量变化前的值。放在前方时则刚好相反，是“先运算再求值”。

上面这个程序和 C 中基本相同，只要小括号 `()` 中的循环条件 `a > 0` 成立，大括号 `{}` 中的值就会**不断执行**，直到条件不再成立，或者遇到 `break` 而被打断。

---

你或许想试试你在 C 中已经熟悉的 `for` 循环：

```c
for (int i = 0; i < n; i++) {
    a[i] = 0;
}
```

很遗憾，这在 Kotlin 中是行不通的，Kotlin 是一门**现代化**的语言，而绝大多数现代化的语言，都在逐渐采取更安全和简便的方式处理数组这样的数据结构。

如果你想在 Kotlin 中使用 `for` 循环，那么一般有两个原因：

- **遍历数组等数据结构**。如果想要进行“取每个元素”这样的操作，那么在 Kotlin 中可以使用  `for-in` 循环：
  
  ```kotlin
  val a = arrayOf(1, 2, 3)
  for (i in a) {
      // 使用取出的值 i
  }
  ```

- **计数循环**。如果要执行指定的次数，那么应该改用 `repeat`：
  
  ```kotlin
  repeat(10) {
      // 重复执行语句
  }
  ```
  
  ?> `repeat` 只是一个普通的方法（函数），能写成类似 `for` 这样的结构，是 Kotlin 函数式编程的体现之一。能这么写的原因，我们将在后面介绍。

---

你可以随时使用 `break` 打断循环，或者使用 `continue` 跳过当前循环体的剩余部分：

```kotlin
var a = 100
while (a > 0) {
    a = a + 2
    if (a > 200) break
    if (a > 150) continue
    a = a + 5
}
```

和 C 中一样，`break` 和 `continue` 在有多层循环时，只会影响最内层（即 `break` 和 `continue` 所在层）的循环。

## 在结束之前

这一节的内容或许不算多，但绝对很新奇！你或许是第一次见到可以作为表达式的 `if-else` 语句，也或许是第一次了解 `for-in` 这样的结构。保持你的新奇，继续探索 Kotlin 的这些与众不同之处。

## 练习题

1. 下面的 `if-else` 表达式会给 `b` 赋什么值？
   
   ```kotlin
   val a = 8
   val b = if (a > 0) {
       if (a > 5) a * 2 else 8
   } else {}
   ```

2. 如果 `a` 是奇数，就把它乘 `3` 再加 `1`；如果 `a` 是偶数，就把它除以 `2`，直到 `a` 变成 `1`。用 `while` 循环尝试实现这个程序。
   
   ?> 你可以使用 `a % 2` 的结果来验证 `a` 是否为偶数，`%` 是取余运算符，`x % y` 的值是 `x` 除以 `y` 之后的余数。

> **解答**
> 
> 1. 这里嵌套了一个 `if-else` 表达式，但分析方法还是相同的。
>    
>    首先，`a > 0` 是成立的，所以外层 `if-else` 表达式的值就是第一个块中最后一条（也是唯一一条）语句的值，也就是内层的 `if-else` 表达式。
>    
>    内层的 `if-else` 表达式条件 `a > 5` 同样成立，其块内的最后一条语句是表达式 `a * 2`，也就是 `16`。
>    
>    所以，内层 `if-else` 表达式的值是 `16`，那么外层 `if-else` 表达式的值也是 `16`，于是最后 `b` 被赋值 `16`。
> 
> 2. 程序可以如下实现：
>    
>    ```kotlin
>    while (a != 1) {
>        a = if (a % 2 == 0) a / 2 else a * 3 + 1
>    }
>    ```
>    
>    如果你使用了不止一个赋值符号 `=`，那么说明你还没有适应 `if-else` 表达式的使用。不过，即使没有适应也没有关系，在 IDEA 中编辑时，它会为你提供修改建议，几番下来就很容易记住了。
