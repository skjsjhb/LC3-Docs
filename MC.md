# MC 游戏背后的故事

## 滴答，滴答

即使是老练的史蒂夫，在熔炉里熔炼这个世界的第一块铁锭时，心里也一定充满了兴奋感。你静静地站在熔炉边上，等待着你新鲜的矿物出炉。一切看上去都很宁静，很祥和，时间不快不慢地流逝过去……对吗？

呃，可能只是对你而言。

在 Minecraft（以及任何其它的游戏中），游戏**每分每秒都要重复做好多事情**。当你在刷怪塔上空挂机时，游戏仍然在不停地寻找怪物的生成地点，移动每个实体的位置，把太阳和月亮移动到它们该在的地方，还得处理你放置和挖掘方块的动作。

如果用 Java 代码来表示，大概就是这样：

```java
while (gameIsRunning) {
    setTime();
    moveEntities();
    pollEvents();
    processEvents();
    // 其它要做的
}
```

这么一个巨大的循环，在 Minecraft 中**每秒都要执行 20 次**。Minecraft 以这么快的速度，不停地更新着各种怪物、物品、天气等游戏元素，你的熔炉，当然，也不例外。

?> 如果电脑比较差劲，Minecraft 一秒钟可能没办法执行 20 次处理，本来该现在做的事情却要在下一秒才能完成，游戏整体变慢，这就是**卡顿（Lag）**。

每秒执行的这 20 次循环就是 Minecraft 运行的基本时间单位，一个循环被称为一**刻（Tick）**。

实际上，Minecraft 在每一刻中要做的事情非常非常多，多到这里都放不下。如果感兴趣，你可以查看 [Minecraft 中文 Wiki 上的有关内容](https://zh.minecraft.wiki/w/%E5%88%BB#%E6%B8%B8%E6%88%8F%E5%88%BB%E6%B5%81%E7%A8%8B)。

?> 顺便一提，Minecraft Wiki 已经从 Fandom 迁移到了新的站点：[https://zh.minecraft.wiki/](https://zh.minecraft.wiki/)。新的网站访问速度更快，而且更加简洁。<br/><img style="height:6rem" src="https://zh.minecraft.wiki/images/Forking_from_Fandom_poster.png?68357"/><br/>我们后面还会用到几次 Wiki，所以你可能想把这个网站收藏起来。

这里我们只列出几件比较重要的事情（引自 Minecraft Wiki）：

- 计算天气循环，更新降雨和雷暴状态

- 执行方块和流体的计划刻（水的流动，红石的点亮和熄灭等）

- 执行区块的区块刻（作物生长，水结冰等）

- 执行周期性的生成（怪物和友好生物的生成等）

- 加载和卸载区块

……等等。

游戏的所有内容都是在这些刻当中处理的。如你所见，游戏运行地是如此的快，我们的插件如果想做些什么，就也得和游戏运行得一样快 —— 这是很麻烦的！

所幸，Bukkit 为我们打开了一条路，这就是……

## 当 ⚑ 被点击

虽然游戏每秒运行 20 次，做很多很多的事情，但你应该还记得，我们编写插件的目的是**修改游戏**。这意味着这样一件事情：

**并非所有的内容我们都要关注，我们的插件只关注特定的事件。**

这也就是说，大多数时候，插件的代码都“睡在”那里，什么也不做，直到它感兴趣的事情发生了，它才醒过来，做完它要做的事情，然后再回去睡觉。

如果放在现实中，就大概是这样的对话：

> 我：Kirara 小姐能不能帮我画张画呢？
> 
> Kirara：（ZZZ）
> 
> 我：Kirara 小姐最可爱了最喜欢你了！
> 
> Kirara：（白了一眼，ZZZ）
> 
> 我：……今晚没你的饭吃了。
> 
> Kirara：（跳起来）什么？！


